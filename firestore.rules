rules_version = '2';
 service cloud.firestore {
  match /databases/{database}/documents {
 

   /**
    * @description Allows public read access to events, but restricts creation, updating, and deletion to admins.
    */
   match /events/{eventId} {
    allow get, list: if true;
    allow create: if isAdmin();
    allow update: if isAdmin();
    allow delete: if isAdmin();
   }
 

   /**
    * @description Allows users to read their own profile data and admins to read any user's profile.
    */
   match /users/{userId} {
    allow get: if isOwner(userId) || isAdmin();
    allow list: if false;
    allow create: if isOwner(userId);
    allow update: if isOwner(userId);
    allow delete: if isOwner(userId);
   }
 

   /**
    * @description Determines admin privileges based on the existence of a document in this collection.
    */
   match /roles_admin/{userId} {
    allow get: if isAdmin();
    allow list: if false;
    allow create: if isAdmin();
    allow update: if isAdmin();
    allow delete: if isAdmin();
   }
 

   /**
    * @description Allows public read access to services, but restricts creation, updating, and deletion to admins.
    */
   match /services/{serviceId} {
    allow get, list: if true;
    allow create: if isAdmin();
    allow update: if isAdmin();
    allow delete: if isAdmin();
   }
 

   /**
    * @description Allows anyone to create a booking inquiry, but restricts reading and updating to admins.
    */
   match /bookings/{bookingId} {
    allow get, list: if isAdmin();
    allow create: if true;
    allow update: if isAdmin();
    allow delete: if isAdmin();
   }
 

   /**
    * @description Allows anyone to submit a contact form, but restricts reading and updating to admins.
    */
   match /contacts/{contactId} {
    allow get, list: if isAdmin();
    allow create: if true;
    allow update: if isAdmin();
    allow delete: if isAdmin();
   }
 

   /**
    * @description Allows public read access to gallery media, but restricts creation, updating, and deletion to admins.
    */
   match /gallery/{mediaId} {
    allow get, list: if true;
    allow create: if isAdmin();
    allow update: if isAdmin();
    allow delete: if isAdmin();
   }
 

   /**
    * @description Allows authenticated users to create likes on gallery items.
    */
   match /gallery/{mediaId}/likes/{likeId} {
    allow get, list: if true;
    allow create: if isSignedIn();
    allow update: if false;
    allow delete: if false;
   }
 

   /**
    * @description Allows authenticated users to create comments on gallery items.  Admins can delete any comment. Users can only delete their own comments.
    */
   match /gallery/{mediaId}/comments/{commentId} {
    allow get: if true;
    allow list: if true;
    allow create: if isSignedIn();
    allow update: if false;
    allow delete: if isSignedIn() && request.auth.uid == resource.data.userId || isAdmin();
   }
 

   /**
    * @description Allows a user to create, update, delete their own bookmarks.
    */
   match /users/{userId}/bookmarks/{bookmarkId} {
    allow get: if isOwner(userId);
    allow list: if isOwner(userId);
    allow create: if isOwner(userId);
    allow update: if isOwner(userId);
    allow delete: if isOwner(userId);
   }
 

   /**
    * @description Allows authenticated users to create suggestions. Admins can read and update suggestions.
    */
   match /suggestions/{suggestionId} {
    allow get, list: if isAdmin();
    allow create: if isSignedIn();
    allow update: if isAdmin();
    allow delete: if isAdmin();
   }
 

    /**
     * @description Allows authenticated users to read resources.  Admins can create, update, and delete resources.
     */
    match /resources/{resourceId} {
     allow get, list: if isSignedIn();
     allow create: if isAdmin();
     allow update: if isAdmin();
     allow delete: if isAdmin();
    }
  }
 

  // --- Helper functions ---
 

  /**
   * @description Checks if the current user is signed in.
   */
  function isSignedIn() {
   return request.auth != null;
  }
 

  /**
   * @description Checks if the current user is the owner of the resource.
   */
  function isOwner(userId) {
   return request.auth.uid == userId;
  }
 

  /**
   * @description Checks if the current user is the owner of the resource and that the resource exists.
   */
  function isExistingOwner(userId) {
   return isOwner(userId) && resource != null;
  }
 

  /**
   * @description Checks if the current user has admin privileges based on the token.
   */
  function isAdmin() {
      return isSignedIn() && get(/databases/$(database)/documents/roles_admin/$(request.auth.uid)).data.isAdmin == true;
  }
 }